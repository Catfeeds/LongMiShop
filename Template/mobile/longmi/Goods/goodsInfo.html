<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <title>{$goods.goods_name}_{$lmshop_config.shop_info_store_title}</title>
    <meta http-equiv="keywords" content="{$lmshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$lmshop_config['shop_info_store_desc']}" />
    <script src="__STATIC__/js/mui.min.js"></script>
    <script src="__STATIC__/js/jquery.min.js"></script>
    <link href="__STATIC__/css/mui.min.css" rel="stylesheet" />
    <link href="__STATIC__/css/css.css" rel="stylesheet" />
    <link href="__STATIC__/css/shopping_cart1.css" rel="stylesheet" />
    <script type="text/javascript" src="__STATIC__/js/touchslider.dev.js"></script>
    <script type="text/javascript" src="__STATIC__/js/layer.js" ></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/css/layer.css"/>
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__PUBLIC__/js/mobile_common.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script type="text/javascript">
        var process_request = "正在处理您的请求...";
    </script>
</head>
<body>
<div class="commodity_top">
    <div class="commodity_top_l"><a href="javascript:history.back(-1);"><img src="__STATIC__/SVG/b1.svg"></a></div>
    <div class="commodity_top_r"><a href="http://www.jiathis.com/share"><img src="__STATIC__/SVG/b2.svg"></a></div>
</div>
<form name="buy_goods_form" method="post" id="buy_goods_form" >
<div id="slider" class="mui-slider" >
    <php>$goods_array =array();</php>
    <foreach  name="goods_images_list" item="pic">
        <php>$goods_array[] = $pic;</php>
    </foreach>
    <php>$goods_array_count = count($goods_array) - 1;</php>
    <notempty name = "goods_array">
        <div class="mui-slider-group mui-slider-loop">
            <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
            <div class="mui-slider-item mui-slider-item-duplicate">
                <a href="javascript:void(0)">
                    <img src="{$goods_array[$goods_array_count]['image_url']}">
                </a>
            </div>
            <foreach name="goods_array" item="pic" >
                <div class="mui-slider-item">
                    <a href="javascript:void(0)">
                        <img src="{$pic.image_url}">
                    </a>
                </div>
            </foreach>
            <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
            <div class="mui-slider-item mui-slider-item-duplicate">
                <a href="javascript:void(0)">
                    <img src="{$goods_array[0]['image_url']}">
                </a>
            </div>
        </div>
        <div class="mui-slider-indicator">
            <php>$goods_array_key = 0;</php>
            <foreach name="goods_array" item="pic" >
                <div class="mui-indicator <if condition='$goods_array_key++ eq 0'> mui-active</if>"></div>
            </foreach>
        </div>
    </notempty>

</div>
<script>
    var gallery = mui('.mui-slider');
    gallery.slider({
        interval:2000//自动轮播周期，若为0则不自动播放，默认为0；
    })
</script>
<div class="price">
    <div class="price_left">{$goods.goods_name}</div>
    <div class="price_right"  id="goods_price">￥{$goods.shop_price}</div>
</div>
<div class="price_main">
    {$goods.goods_content|htmlspecialchars_decode}
</div>
<!--<div class="price_main">-->
    <!--<div class="titel_box">用户评价</div>-->
<!--</div>-->
<!--<div class="evaluate_box">-->
    <!--<div class="evaluate">-->
        <!--<div class="ev_box">-->
            <!--<div class="ev_box_l"><img src="images/user_48.png" width="48" height="48"></div>-->
            <!--<div class="ev_box_r">Anniebear<span>16/01/01</span></div>-->
        <!--</div>-->
        <!--<div class="ev_txt">大米很不错，很好！一年一季，没有残留农药！</div>-->
    <!--</div>-->
    <!--<div class="evaluate">-->
        <!--<div class="ev_box">-->
            <!--<div class="ev_box_l"><img src="images/user_48.png" width="48" height="48"></div>-->
            <!--<div class="ev_box_r">Anniebear<span>16/01/01</span></div>-->
        <!--</div>-->
        <!--<div class="ev_txt">大米很不错，很好！一年一季，没有残留农药！</div>-->
    <!--</div>-->
<!--</div>-->
<div style="height:55px"></div>
<div class="com_d">
    <div class="com_d_l">
        <div class="collect"  onclick="collect_goods({$goods.goods_id})" id="favorite_add"> </div>
    </div>
    <div class="com_d_r">
        <div class="c_btn1"><a href="#picture" onclick="$('#next1').show();$('#next2').hide();">立即购买</a></div>
        <div class="c_btn2"><a href="#picture" onclick="$('#next2').show();$('#next1').hide();">加入购物车</a></div>
    </div>
</div>
<div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
    <div class="cp2">
        <div class="cp2_l"><img src="{$goods.goods_id|goods_thum_images=400,400}" width="92" height="92"></div>
        <div class="cp2_r">
            <p>{$goods.goods_name}</p>
            <span>￥{$goods.shop_price}</span>
            <div class="gw_num">
                <em class="jian" onClick="goods_cut();">-</em>
                <input type="text" value="1"  min="1" max="1000" name="goods_num"  id="number"  class="num"/>
                <input type="hidden" name="goods_id" value="{$goods.goods_id}"/>
                <em class="add" onClick="goods_add();">+</em>
            </div>
        </div>
    </div>

    <div class="m33">
        <foreach item="spec" key="key" name="filter_spec">
            <div class="cp2_titel">{$key}</div>
            <ul>
                <foreach name="spec" item="v2" key="k2">
                <li onclick="switch_spec(this);" class="<if condition='$k2 eq 0'>m33_hover</if>">
                    <p><a href="javascript:;"  title="{$v2[item]}" >{$v2[item]}</a></p>
                    <input type="radio" style="display:none;" name="goods_spec[{$key}]" value="{$v2[item_id]}" <if condition="$k2 eq 0 ">checked="checked"</if>/>
                </li>
                </foreach>
            </ul>
        </foreach>

        <div class="m33_btn" id="next1"><a href="javascript:void(0);"  onclick="AjaxAddCart({$goods.goods_id},1,1);">下一步</a></div>
        <div class="m33_btn" id="next2"><a href="javascript:void(0);" onClick="AjaxAddCart({$goods.goods_id},1,0);">加入购物车</a></div>

    </div>
</div>
<script type="text/javascript">
    $(function(){
        $(".subNav").click(function(){
            $(this).next(".navContent").slideToggle(300).siblings(".navContent").slideUp(500);
            $(this).toggleClass("on").siblings(".subNav").removeClass("on");
            if($(".is_scroll").length <= 0)
            {
                $('html,body').animate({'scrollTop':$('body')[0].scrollHeight},600);
            }
        });
        commentType = 1; // 评论类型
//        ajaxComment(1,1);// ajax 加载评价列表
    })
function click_search (){
  var search_ka = document.getElementById("search_ka");
  	if (search_ka.className == "s-buy open ui-section-box"){
	  	search_ka.className = "s-buy ui-section-box";
	}else {
		search_ka.className = "s-buy open ui-section-box";
	}
}

function changeAtt(t) {
	t.lastChild.checked='checked';
	for (var i = 0; i<t.parentNode.childNodes.length;i++) {
	    if (t.parentNode.childNodes[i].className == 'hover') {
	        t.parentNode.childNodes[i].className = '';
			t.childNodes[0].checked="checked";
		}
	}
	t.className = "hover";
	changePrice();
}

function changeAtt1(t) {
	t.lastChild.checked='checked';
	for (var i = 0; i<t.parentNode.childNodes.length;i++) {
	    if (t.className == 'hover') {
	           t.className = '';
			t.childNodes[0].checked = false;
		}
		else{
			t.className="hover";
			t.childNodes[0].checked = true;
		}
	}
	changePrice();
}

	function goods_cut(){
  		var num_val=document.getElementById('number');
  		var new_num=num_val.value;
  		var Num = parseInt(new_num);
  		if(Num>1)Num=Num-1;
  		num_val.value=Num;
  	}
  	function goods_add(){
  		var num_val=document.getElementById('number');
  		var new_num=num_val.value;
  		var Num = parseInt(new_num);
  		Num=Num+1;  num_val.value=Num;
  	}
    function switch_spec(spec)
    {
        $(spec).siblings().removeClass('m33_hover');
        $(spec).addClass('m33_hover');
        $(spec).siblings().children('input').prop('checked',false);
        $(spec).children('input').prop('checked',true);
        //更新商品价格
        get_goods_price();
    }

    function get_goods_price()
    {
        var goods_price = {$goods.shop_price}; // 商品起始价
        var store_count = {$goods.store_count}; // 商品起始库存
        var spec_goods_price = {$spec_goods_price};  // 规格 对应 价格 库存表   //alert(spec_goods_price['28_100']['price']);
        // 如果有属性选择项
        if(spec_goods_price != null)
        {
            goods_spec_arr = new Array();
            $("input[name^='goods_spec']:checked").each(function(){
                goods_spec_arr.push($(this).val());
            });
            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            goods_price = spec_goods_price[spec_key]['price']; // 找到对应规格的价格
            store_count = spec_goods_price[spec_key]['store_count']; // 找到对应规格的库存
        }
        var goods_num = parseInt($("#goods_num").val());
        // 库存不足的情况
        if(goods_num > store_count)
        {
            goods_num = store_count;
            alert('库存仅剩 '+store_count+' 件');
            $("#goods_num").val(goods_num);
        }
        $("#goods_price").html('￥'+goods_price+''); // 变动价格显示

    }

    function sortNumber(a,b)
    {
        return a - b;
    }

    function ajaxComment(commentType,page){
        $.ajax({
            type : "GET",
            url:"/index.php?m=Mobile&c=goods&a=ajaxComment&goods_id={$goods['goods_id']}&commentType="+commentType+"&p="+page,//+tab,
            success: function(data){
                $(".my_comment_list").empty().append(data);
                var myPhotoSwipe = $("#gallery a").photoSwipe({
                    enableMouseWheel: false,
                    enableKeyboard: false,
                    allowUserZoom: false,
                    loop:false
                });
            }
        });
    }

    $(document).ready(function(){
        var cart_cn = getCookie('cn');
        if(cart_cn == ''){
            $.ajax({
                type : "GET",
                url:"/index.php?m=Home&c=Cart&a=header_cart_list",//+tab,
                success: function(data){
                    cart_cn = getCookie('cn');
                }
            });
        }
        $('#tp_cart_info').html(cart_cn);
    });
</script>
</form>
</body>
</html>