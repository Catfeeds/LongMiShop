<include file="Public/header"/>

<body>


<div class="top_nav">
    <div class="top_nav_left">
        <a href="{:U('Mobile/Goods/goodsList')}">全部</a>
        <a href="{:U('Mobile/Goods/goodsList')}">新品</a>
        <a href="{:U('Mobile/Goods/goodsList',array('sort'=>'sales_sum'))}">销量</a>
    </div>
    <form name="sourch_form" id="sourch_form" method="post" action="{:U('Mobile/Goods/goodsList')}">
        <div class="top_nav_right">
            <div class="top_nav_find">
                <input name="q" id="q"  type="text" value="<?php echo I('q'); ?>" placeholder="龙米" />
                <a href="javascript:if($.trim($('#q').val()) != '') $('#sourch_form').submit();" >
                    <img src="__STATIC__/SVG/search_r.svg">
                </a>
            </div>
        </div>
    </form>
</div>



<div id="slider" class="mui-slider" >
    <php>$adv_array =array();</php>
    <adv pid ="2" limit="5" item="v">
        <php>$adv_array[] = $v;</php>
    </adv>
    <php>$adv_array_count = count($adv_array) - 1;</php>
    <notempty name = "adv_array">
        <div class="mui-slider-group mui-slider-loop">
            <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
            <div class="mui-slider-item  mui-slider-item-duplicate">
                <a href="{$adv_array[$adv_array_count]['ad_link']}" <if condition="$adv_array[$adv_array_count]['target'] eq 1">target="_blank"</if>>
                <img src="{$adv_array[$adv_array_count]['ad_code']}" title="{$adv_array[$adv_array_count]['title']}"width="100%" style="{$adv_array[$adv_array_count]['style']}">
                </a>
            </div>
            <foreach name="adv_array" item="v" >
                <div class="mui-slider-item">
                    <a href="{$v.ad_link}" <if condition="$v['target'] eq 1">target="_blank"</if>>
                    <img src="{$v[ad_code]}" title="{$v[title]}"width="100%" style="{$v[style]}">
                    </a>
                </div>
            </foreach>
            <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
            <div class="mui-slider-item  mui-slider-item-duplicate">
                <a href="{$adv_array[0]['ad_link']}" <if condition="$adv_array[0]['target'] eq 1">target="_blank"</if>>
                <img src="{$adv_array[0]['ad_code']}" title="{$adv_array[0]['title']}"width="100%" style="{$adv_array[0]['style']}">
                </a>
            </div>
        </div>
        <div class="mui-slider-indicator">
            <php>$adv_array_key = 0;</php>
            <foreach name="adv_array" item="v" >
                <div class="mui-indicator <if condition='$adv_array_key++ eq 0'> mui-active</if>"></div>
            </foreach>
        </div>
    </notempty>
</div>



<div class="top_menu">
    <ul>
        <li>
            <p>
                <a href="{:U('Mobile/User/account')}">钱包</a>
            </p>
        </li>
        <li style="background-image:url('__STATIC__/images/new/nav_2.png')">
            <p>
                <a href="{:U('Mobile/User/coupon')}">优惠券</a>
            </p>
        </li>
        <li style="background-image:url('__STATIC__/images/new/nav_3.png')">
            <p>
                <a href="{:U('Mobile/Recommend/index')}">推荐有奖</a>
            </p>
        </li>
        <li style="background-image:url('__STATIC__/images/new/nav_4.png')">
            <p>
                <a href="{:U('Mobile/User/myPoster')}">赚米</a>
            </p>
        </li>
    </ul>
</div>


<div class="index_title">
    <img src="__STATIC__/images/new/suixinda3.png">
</div>

<div class="mui-content">
    <ul class="mui-table-view">
        <foreach name="newGoods" item="newGoodsItem" key="newGoodsKey">
            <li class="mui-table-view-cell">
                <div class="mui-slider-handle">
                    <div class="c"><a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$newGoodsItem['goods_id']))}"></a></div>
                    <div class="cp_index">
                        <div class="cp_index_l">
                            <a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$newGoodsItem['goods_id']))}">
                                <img src="{$newGoodsItem['goods_id']|goods_thum_images=92,92}" width="92" height="92">
                            </a>
                        </div>
                        <div class="cp_index_r">
                            <p class="cj1">{$newGoodsItem.goods_name}</p>
                            <p >
                                <span>￥{$newGoodsItem.shop_price}</span>
                            </p>
                            <p>
                                <a class="cp_index_buy" href="{:U('Mobile/Goods/goodsInfo',array('id'=>$newGoodsItem['goods_id']));}">
                                    立即购买
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </li>
        </foreach>
    </ul>
</div>


<div class="index_title">
    <img src="__STATIC__/images/new/suixinda.png">
</div>

<div class="mui-content">
    <ul class="mui-table-view">
        <li class="mui-table-view-cell">
            <div class="mui-slider-handle">
                <div class="c"><a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$goods_id))}"></a></div>
                <div class="cp_index">
                    <div class="cp_index_l">
                        <a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$v[goods_id]))}">
                            <img src="{$goods_id|goods_thum_images=92,92}" width="92" height="92">
                        </a>
                    </div>
                    <div class="cp_index_r">
                        <p class="cj1">{$goods.goods_name}</p>
                        <p >
                            <span>￥{$goods.shop_price}</span>
                        </p>
                        <p>
                            <a class="cp_index_buy" href="{:U('Mobile/Goods/goodsInfo',array('id'=>$goods_id));}">
                                立即购买
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </li>
    </ul>
</div>

<div class="index_title">
    <img src="__STATIC__/images/new/suxinda2.png">
</div>


<div class="mui-content">
    <ul class="mui-table-view">
        <foreach item="spec" key="key" name="spec_goods_price">
            <li class="mui-table-view-cell">
                <div class="mui-slider-handle">
                    <div class="c"><a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$goods_id,'spec_key'=>$spec['key']))}"></a></div>
                    <div class="cp_index">
                        <div class="cp_index_l">
                            <a href="{:U('Mobile/Goods/goodsInfo',array('id'=>$spec['goods_id']))}">
                                <img src="{:$spec['img']?'__STATIC__/images/new/'.$spec['img']:'';}" width="92" height="92">
                            </a>
                        </div>
                        <div class="cp_index_r">
                            <p class="cj1">我是彩蛋</p>
                            <p >
                                <span>{$spec.key_name}</span>
                            </p>
                            <div class="my-mui-numbox z-index" data-numbox-min='0' data-numbox-max='99'>
                                <button class="mui-btn mui-btn-numbox-minus" onclick="switch_num(-1,'{$goods_id}','{$spec.key}','{$spec.store_count}');" type="button">-</button>
                                <input id="goods_num_{$spec.key}" class="mui-input-numbox cp_index_number" type="text" onKeyDown='if(event.keyCode == 13) event.returnValue = false'  value="{:$cart_data[$spec['key']]?$cart_data[$spec['key']]:0}"/>
                                <button class="mui-btn mui-btn-numbox-plus"  onclick="switch_num(1,'{$goods_id}','{$spec.key}','{$spec.store_count}');" type="button">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </foreach>
    </ul>
</div>
<include file="Public/nav"/>
</body>


<include file="Public/footer"/>


<script type="text/javascript">

    $(function(){
        TouchSlide({
            slideCell:"#picScroll",
            titCell:".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
            autoPage:true, //自动分页
            pnLoop:"false", // 前后按钮不循环
            switchLoad:"_src", //切换加载，真实图片路径为"_src"
            autoPlay:true
        });
        var gallery = mui('.mui-slider');
        gallery.slider({
            interval: 2000//自动轮播周期，若为0则不自动播放，默认为0；
        })
    });

    var before_request = 1; // 上一次请求是否已经有返回来, 有才可以进行下一次请求

    function switch_num(number,goods_id,key,store_count) {
        if (before_request == 0)
        {
//            $("#goods_num_" + key).val(num2);
            alert("点击太频繁 ,休息一下");
            return false;
        }
        var num2 = parseInt($("#goods_num_" + key).val());
        num2 += number;
//        if (num2 < 1) num2 = 0; // 保证购买数量不能少于 1
        if (num2 > store_count) {
            alert("库存只有 " + store_count + " 件, 你只能买 " + store_count + " 件");
            num2 = store_count; // 保证购买数量不能多余库存数量
            $("#goods_num_" + key).val(num2);
            return false;
        }
        before_request = 0;
        $.ajax({
            type : "POST",
            url:"{:U('Mobile/Cart/ajaxChangeCartData')}",
            data : {number:number,goods_id:goods_id,key:key},
            dataType:"json",
            success: function(data){

                alert(data.msg);
                if( data.status==1){
                    $("#goods_num_" + key).val(num2);
                }
                before_request = 1;
            },
            error:function(){
                before_request = 1;
            }
        });
    }

</script>
</html>